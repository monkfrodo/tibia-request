<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tibia Access Tool</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: Tahoma, Verdana, sans-serif;
      color: #2b1904;
      background: #000016 url("https://static.tibia.com/images/global/background/bg_blue.jpg") center top no-repeat;
      background-size: cover;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .page-wrapper {
      max-width: 1100px;
      margin: 0 auto;
      padding-bottom: 40px;
    }

    /* ===== TOP BAR / HEADER ===== */
    .top-header {
      margin-top: 18px;
      height: 160px;
      background: url("https://static.tibia.com/images/global/header/headerartwork_20years.jpg") center top no-repeat;
      background-size: cover;
      border: 3px solid #2f1605;
      border-radius: 6px;
      box-shadow: 0 0 16px rgba(0,0,0,0.9);
      position: relative;
    }

    .top-header-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.7));
      border-radius: 4px;
    }

    .top-header-inner {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      padding: 10px 18px;
      color: #fbe7c0;
    }

    .logo-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-title {
      font-size: 26px;
      font-weight: 700;
      color: #ffe88c;
      text-shadow: 2px 2px 0 #2a0d00;
    }

    .logo-sub {
      font-size: 11px;
      color: #f8e0b1;
    }

    .top-info {
      font-size: 11px;
      text-align: right;
    }

    /* ===== MAIN LAYOUT ===== */
    .main {
      margin-top: 10px;
      display: grid;
      grid-template-columns: 210px 1fr 210px;
      grid-gap: 8px;
    }

    /* ===== LEFT SIDEBAR (MENU) ===== */
    .left-sidebar {
      background: url("https://static.tibia.com/images/global/content/scroll.gif");
      border: 2px solid #3a2620;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.8);
      padding: 8px;
    }

    .nav-box {
      margin-bottom: 10px;
      border: 2px solid #251510;
      border-radius: 4px;
      background: #1e120c;
      box-shadow: 0 0 6px rgba(0,0,0,0.7);
    }

    .nav-box-header {
      background: linear-gradient(to bottom, #3f2a16, #231307);
      border-bottom: 1px solid #000;
      color: #f6d98a;
      padding: 6px 8px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .nav-box-body {
      padding: 6px 4px 8px;
      background: #26160b;
    }

    .nav-button {
      display: block;
      text-align: center;
      margin: 4px 4px;
      padding: 6px 0;
      border-radius: 3px;
      border: 2px solid #f4dd8b;
      background: linear-gradient(to bottom, #ffd76c, #b67b1a);
      color: #271200;
      font-size: 12px;
      font-weight: 700;
      text-shadow: 1px 1px 0 #ffeeb9;
      cursor: pointer;
    }

    .nav-button.blue {
      border-color: #c6d4f7;
      background: linear-gradient(to bottom, #6aa3ff, #21498b);
      color: #eef2ff;
      text-shadow: 1px 1px 0 #1c2950;
    }

    .nav-link {
      display: block;
      padding: 4px 8px;
      font-size: 11px;
      color: #f1e1c4;
      border-radius: 3px;
      cursor: pointer;
    }

    .nav-link:hover {
      background: rgba(255,255,255,0.08);
    }

    .nav-link.active {
      background: #6c4b1d;
      font-weight: 700;
    }

    /* ===== RIGHT SIDEBAR (DECOR) ===== */
    .right-sidebar {
      background: url("https://static.tibia.com/images/global/content/scroll.gif");
      border: 2px solid #3a2620;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.8);
      padding: 8px;
      font-size: 11px;
      color: #f8e0b3;
    }

    .right-box {
      margin-bottom: 10px;
      border-radius: 4px;
      border: 2px solid #2d1811;
      background: #1f130b;
      overflow: hidden;
    }

    .right-box-header {
      background: linear-gradient(to bottom, #5b2b12, #2f1408);
      color: #ffe9a5;
      padding: 5px 8px;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 11px;
    }

    .right-box-body {
      padding: 6px 8px 8px;
      background: #24140b;
    }

    .right-banner {
      width: 100%;
      height: 90px;
      background: url("https://static.tibia.com/images/global/header/headerartwork_winter2020.jpg") center center no-repeat;
      background-size: cover;
      border-radius: 2px;
      margin-bottom: 6px;
    }

    /* ===== CENTER CONTENT ===== */
    .content-wrapper {
      border: 3px solid #4a2d10;
      border-radius: 6px;
      box-shadow: 0 0 12px rgba(0,0,0,0.9);
      overflow: hidden;
    }

    .content-header {
      background: linear-gradient(to bottom, #6e1212, #3d0505);
      border-bottom: 2px solid #191008;
      color: #ffe8b5;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .content-inner {
      background: #e3cfaa url("https://static.tibia.com/images/global/content/scroll.gif");
      padding: 14px 16px 18px;
    }

    .news-title {
      font-size: 18px;
      color: #4a2603;
      margin-bottom: 4px;
    }

    .news-meta {
      font-size: 11px;
      color: #7b4e13;
      margin-bottom: 8px;
    }

    .info-box {
      font-size: 12px;
      background: rgba(255,255,255,0.7);
      border-radius: 6px;
      border: 1px solid #d2b273;
      padding: 8px 10px;
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-top: 12px;
      font-size: 13px;
      font-weight: 700;
      color: #4a2603;
    }

    input, textarea {
      width: 100%;
      padding: 8px 10px;
      margin-top: 4px;
      border-radius: 4px;
      border: 1px solid #c39b63;
      background: #f9f0de;
      font-size: 13px;
      color: #2f1602;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #b57c24;
      box-shadow: 0 0 0 1px rgba(181,124,36,0.5);
    }

    .btn-main {
      margin-top: 14px;
      padding: 9px 12px;
      border-radius: 4px;
      border: 2px solid #f4dd8b;
      background: linear-gradient(to bottom, #ffd76c, #b67b1a);
      color: #271200;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      text-shadow: 1px 1px 0 #ffeeb9;
    }

    .btn-main:hover {
      filter: brightness(1.07);
    }

    #char-info {
      margin-top: 10px;
      padding: 8px 9px;
      border-radius: 4px;
      border: 1px solid #c29b4b;
      background: rgba(255,255,255,0.85);
      font-size: 12px;
      display: none;
    }

    #step2, #step3 {
      display: none;
    }

    #message {
      margin-top: 10px;
      font-size: 12px;
      font-weight: 700;
      color: #7c390c;
      text-align: center;
    }

    /* ===== FOOTER ===== */
    .footer {
      margin-top: 16px;
      text-align: center;
      font-size: 11px;
      color: #f0e4cf;
      text-shadow: 1px 1px 0 #000;
      opacity: 0.9;
    }

    @media (max-width: 980px) {
      .main {
        grid-template-columns: 200px 1fr;
        grid-template-rows: auto auto;
        grid-template-areas:
          "left center"
          "right center";
      }

      .left-sidebar { grid-area: left; }
      .content-wrapper { grid-area: center; }
      .right-sidebar { grid-area: right; }
    }

    @media (max-width: 780px) {
      .main {
        grid-template-columns: 1fr;
        grid-template-areas:
          "center"
          "left"
          "right";
      }

      .top-header {
        height: 120px;
      }
    }
  </style>
</head>
<body>

<div class="page-wrapper">

  <!-- HEADER -->
  <div class="top-header">
    <div class="top-header-overlay"></div>
    <div class="top-header-inner">
      <div class="logo-block">
        <div>
          <div class="logo-title">Tibia Access Tool</div>
          <div class="logo-sub">Organizador de acessos de quests & bosses</div>
        </div>
      </div>
      <div class="top-info">
        Fan tool não-oficial • Dados via TibiaData API<br>
        Pedidos armazenados em Google Sheets
      </div>
    </div>
  </div>

  <!-- MAIN LAYOUT -->
  <div class="main">

    <!-- LEFT SIDEBAR -->
    <div class="left-sidebar">
      <!-- Login / Download -->
      <div class="nav-box">
        <div class="nav-box-header">Account</div>
        <div class="nav-box-body">
          <div class="nav-button blue">Login</div>
          <div class="nav-button">Create Account</div>
          <div class="nav-button blue">Download</div>
        </div>
      </div>

      <!-- Menu principal -->
      <div class="nav-box">
        <div class="nav-box-header">Navigation</div>
        <div class="nav-box-body">
          <div class="nav-link active">Quest Access Tool</div>
          <div class="nav-link">Requests List (em breve)</div>
          <div class="nav-link">Teams & Parties (em breve)</div>
        </div>
      </div>

      <!-- Info extra -->
      <div class="nav-box">
        <div class="nav-box-header">Info</div>
        <div class="nav-box-body">
          <div class="nav-link">Fan project for guilds</div>
          <div class="nav-link">Not affiliated with CipSoft</div>
        </div>
      </div>
    </div>

    <!-- CENTER CONTENT -->
    <div class="content-wrapper">
      <div class="content-header">Quest Access Requests</div>
      <div class="content-inner">
        <div class="news-title">Organize seus acessos</div>
        <div class="news-meta">
          Use esta ferramenta para registrar quais quests ou bosses você precisa de acesso.
        </div>

        <div class="info-box">
          1) Digite o nome do personagem Tibia e clique em <b>Validar personagem</b>.<br>
          2) Confirme level e vocação.<br>
          3) Informe a quest/boss desejada e, se quiser, detalhes de horário ou time.
        </div>

        <!-- STEP 1 -->
        <label>Nome do personagem *</label>
        <input id="charName" placeholder="Ex: Kevin Eger">

        <button class="btn-main" onclick="validateChar()">Validar personagem</button>

        <div id="char-info"></div>

        <!-- STEP 2 -->
        <div id="step2">
          <label>Quest / Boss desejado *</label>
          <input id="requestedAccess" placeholder="Ex: Roshamuul, Falcon, Warzone, Ferumbras, etc.">
        </div>

        <!-- STEP 3 -->
        <div id="step3">
          <label>Notas (opcional)</label>
          <textarea id="notes" placeholder="Horários disponíveis, world, se já tem parte do acesso, etc."></textarea>

          <button class="btn-main" onclick="submitForm()">Enviar pedido</button>
          <div id="message"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT SIDEBAR -->
    <div class="right-sidebar">
      <div class="right-box">
        <div class="right-box-header">Webshop</div>
        <div class="right-box-body">
          <div class="right-banner"></div>
          <div>Planeje acessos como se fosse um fansite oficial da guild.</div>
        </div>
      </div>

      <div class="right-box">
        <div class="right-box-header">Networks</div>
        <div class="right-box-body">
          <div>Conecte este tool com Discord, planilhas e bots da guild (futuras integrações).</div>
        </div>
      </div>

      <div class="right-box">
        <div class="right-box-header">Tips</div>
        <div class="right-box-body">
          <ul style="padding-left:18px; margin:0;">
            <li>Use um nome de char válido.</li>
            <li>Descreva acessos complexos nas notas.</li>
            <li>Combine com o time no Discord.</li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <!-- FOOTER -->
  <div class="footer">
    Tibia é uma marca registrada da CipSoft GmbH. Este é um fan tool não-oficial criado apenas para organização de acessos.
  </div>

</div>

<script>
  let charData = null;

  async function validateChar() {
    const nameInput = document.getElementById("charName");
    const name = nameInput.value.trim();
    const message = document.getElementById("message");
    const infoBox = document.getElementById("char-info");

    message.innerHTML = "";
    infoBox.style.display = "none";
    infoBox.innerHTML = "";
    charData = null;
    document.getElementById("step2").style.display = "none";
    document.getElementById("step3").style.display = "none";

    if (!name) {
      message.innerHTML = "Digite o nome do personagem.";
      return;
    }

    message.innerHTML = "Validando personagem...";

    try {
      const url = `https://api.tibiadata.com/v4/character/${encodeURIComponent(name)}`;
      const r = await fetch(url);
      const json = await r.json();

      if (!json.character || !json.character.character) {
        message.innerHTML = "Personagem não encontrado.";
        return;
      }

      const c = json.character.character;
      charData = c;

      infoBox.style.display = "block";
      infoBox.innerHTML = `
        <b>Nome:</b> ${c.name}<br>
        <b>Level:</b> ${c.level}<br>
        <b>Vocação:</b> ${c.vocation}
      `;

      message.innerHTML = "";
      document.getElementById("step2").style.display = "block";
      document.getElementById("step3").style.display = "block";

    } catch (err) {
      console.error(err);
      message.innerHTML = "Erro ao consultar TibiaData. Tente novamente em alguns instantes.";
    }
  }

  async function submitForm() {
    const message = document.getElementById("message");

    if (!charData) {
      message.innerHTML = "Valide o personagem antes de enviar o pedido.";
      return;
    }

    const requestedAccess = document.getElementById("requestedAccess").value.trim();
    const notes = document.getElementById("notes").value.trim();

    if (!requestedAccess) {
      message.innerHTML = "Informe a quest ou o boss desejado.";
      return;
    }

    const payload = {
      charName: charData.name,
      level: charData.level,
      vocation: charData.vocation,
      requestedAccess: requestedAccess,
      notes: notes
    };

    const backendUrl = "https://script.google.com/macros/s/AKfycbxXNT-qfqMwpDpI5YidY8ZS1_DFS3Ey2bP39qj4KM-DL2wljYaa6dptBrSs-D5dZhNk/exec";

    message.innerHTML = "Enviando pedido...";

    try {
      const res = await fetch(backendUrl, {
        method: "POST",
        body: JSON.stringify(payload)
      });

      const final = await res.json();

      if (final.success) {
        message.innerHTML = "Pedido registrado com sucesso!";
        document.getElementById("requestedAccess").value = "";
        document.getElementById("notes").value = "";
      } else {
        message.innerHTML = "Erro ao salvar. Tente novamente.";
      }
    } catch (err) {
      console.error(err);
      message.innerHTML = "Erro de comunicação com o servidor. Tente novamente.";
    }
  }
</script>

</body>
</html>
