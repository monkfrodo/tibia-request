<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tibia Access Manager</title>

<!-- Fonte -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* ----- RESET ----- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* ----- BACKGROUND ----- */
body {
    font-family: 'Inter', sans-serif;
    background-image: url('https://www.tibiabr.com/wp-content/uploads/2020/01/paulo-silvente-roshamuul-ld-alternative.jpg');
    background-size: cover;
    background-position: center;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

/* ----- DARK OVERLAY ----- */
body::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(3px);
}

/* ----- CONTAINER ----- */
#mainBox {
    position: relative;
    width: 540px;
    padding: 40px 32px;
    border-radius: 14px;
    background: rgba(15, 15, 15, 0.75);
    border: 1px solid rgba(255, 215, 0, 0.35);
    box-shadow: 0 0 25px rgba(0,0,0,0.55);
    text-align: center;
}

/* ----- ICON ----- */
#icon img {
    width: 56px;
    margin-bottom: 14px;
}

/* ----- TITLE ----- */
h1 {
    color: #f8e29c;
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 8px;
}

p.subtitle {
    color: #ddd;
    font-size: 15px;
    margin-bottom: 28px;
}

/* ----- INPUTS ----- */
input, button {
    width: 100%;
    padding: 13px 16px;
    font-size: 15px;
    border-radius: 8px;
    border: none;
    margin-bottom: 16px;
}

input {
    background: rgba(255,255,255,0.12);
    color: white;
    border: 1px solid rgba(255,255,255,0.15);
}

input::placeholder {
    color: #ddd;
}

/* ----- BUTTON ----- */
button {
    background: #d7b259;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
}

button:hover {
    background: #c49d42;
}

/* ----- RESULT BOX ----- */
#charResult {
    display: none;
    margin-top: 12px;
    margin-bottom: 10px;
    padding: 14px;
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
    color: #fff;
    text-align: left;
    font-size: 15px;
}

.error {
    color: #ff6b6b;
    font-weight: 600;
}

/* ----- QUEST BOX ----- */
#questName {
    display: none;
}

#sendButton {
    display: none;
}
</style>
</head>

<body>

<div id="mainBox">
    
    <!-- √çcone Tibia -->
    <div id="icon">
        <img src="https://www.tibiawiki.com.br/images/0/0f/Ferumbras.gif">
    </div>

    <h1>Tibia Access Manager</h1>
    <p class="subtitle">Valide seu personagem e registre pedidos de acesso a quests e bosses.</p>

    <!-- Campo do personagem -->
    <input type="text" id="charName" placeholder="Digite o nome do personagem">

    <button onclick="validateCharacter()">Validar personagem</button>

    <!-- Resultado -->
    <div id="charResult"></div>

    <!-- Campo de quest -->
    <input type="text" id="questName" placeholder="Digite a quest/boss (autocomplete)">

    <!-- Enviar -->
    <button id="sendButton" onclick="sendRequest()">Enviar Pedido</button>

</div>

<script>
// üî• Lista completa de quests carregada externamente (JSON local ou remoto)
const questsURL = "quests.json";
let allQuests = [];

/* ------------------------------------------------------------
   üîÑ CARREGA A LISTA DE QUESTS (autocomplete)
------------------------------------------------------------ */
fetch(questsURL)
    .then(r => r.json())
    .then(data => {
        allQuests = data;
        setupAutocomplete();
    })
    .catch(err => console.error("Erro ao carregar quests:", err));

function setupAutocomplete() {
    const input = document.getElementById("questName");

    input.addEventListener("input", () => {
        const val = input.value.toLowerCase();
        const suggestions = allQuests.filter(q => q.toLowerCase().includes(val)).slice(0, 8);

        closeAutocomplete();

        if (!val) return;

        const list = document.createElement("div");
        list.setAttribute("id", "autocomplete-list");
        list.style.background = "rgba(0,0,0,0.75)";
        list.style.color = "white";
        list.style.padding = "6px";
        list.style.borderRadius = "6px";
        list.style.marginTop = "-10px";

        input.parentNode.appendChild(list);

        suggestions.forEach(q => {
            const item = document.createElement("div");
            item.style.padding = "6px";
            item.style.cursor = "pointer";
            item.innerText = q;

            item.onclick = () => {
                input.value = q;
                closeAutocomplete();
            };

            list.appendChild(item);
        });
    });
}

function closeAutocomplete() {
    const list = document.getElementById("autocomplete-list");
    if (list) list.remove();
}

/* ------------------------------------------------------------
   ‚úî FUN√á√ÉO QUE VALIDA O PERSONAGEM (API TibiaData v2)
------------------------------------------------------------ */
async function validateCharacter() {
    const name = document.getElementById("charName").value.trim();
    const box = document.getElementById("charResult");

    if (!name) {
        box.style.display = "block";
        box.innerHTML = "<span class='error'>Digite o nome do personagem.</span>";
        return;
    }

    box.style.display = "block";
    box.innerHTML = "Validando...";

    try {
        // üî• NOVA API v3
        const res = await fetch(`https://api.tibiadata.com/v3/character/${encodeURIComponent(name)}`);

        if (!res.ok) {
            box.innerHTML = "<span class='error'>Erro ao consultar personagem.</span>";
            return;
        }

        const data = await res.json();

        // üî• Estrutura nova da API
        const c = data.character;

        if (!c || !c.name) {
            box.innerHTML = "<span class='error'>‚ùå Personagem n√£o encontrado.</span>";
            return;
        }

        window.currentChar = c.name;
        window.currentLevel = c.level;
        window.currentVoc = c.vocation;

        box.innerHTML = `
            <strong>Nome:</strong> ${c.name}<br>
            <strong>N√≠vel:</strong> ${c.level}<br>
            <strong>Voca√ß√£o:</strong> ${c.vocation}
        `;

        document.getElementById("questName").style.display = "block";
        document.getElementById("sendButton").style.display = "block";

    } catch (err) {
        box.innerHTML = "<span class='error'>Erro ao validar personagem.</span>";
        console.error(err);
    }
}

/* ------------------------------------------------------------
   ‚úî ENVIA PARA O GOOGLE SHEETS
------------------------------------------------------------ */
async function sendRequest() {
    const quest = document.getElementById("questName").value.trim();

    if (!quest) {
        alert("Digite uma quest ou boss.");
        return;
    }

    const payload = {
        charName: window.currentChar,
        level: window.currentLevel,
        vocation: window.currentVoc,
        requestedAccess: quest,
        notes: ""
    };

    await fetch("https://script.google.com/macros/s/AKfycbxXNT-qfqMwpDpI5YidY8ZS1_DFS3Ey2bP39qj4KM-DL2wljYaa6dptBrSs-D5dZhNk/exec", {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify(payload)
    });

    alert("Pedido enviado com sucesso!");
}
</script>

</body>
</html>
