<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Tibia Access Tool</title>

<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Tahoma, Verdana, sans-serif;
    background: #000016 url("https://static.tibia.com/images/global/background/bg_blue.jpg") no-repeat center top;
    background-size: cover;
    color: #2b1a04;
  }

  /* Container central */
  .main-wrapper {
    max-width: 740px;
    margin: 60px auto;
    border: 3px solid #4a2d10;
    border-radius: 6px;
    box-shadow: 0 0 14px rgba(0,0,0,0.9);
    overflow: hidden;
  }

  /* Header estilo Tibia */
  .header {
    background: linear-gradient(to bottom, #6d0f0f, #410505);
    padding: 10px 14px;
    border-bottom: 2px solid #1d0c05;
    font-size: 15px;
    font-weight: bold;
    color: #ffe7aa;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Corpo estilo pergaminho */
  .content {
    background: #e7d2a8 url("https://static.tibia.com/images/global/content/scroll.gif");
    padding: 20px 22px 30px;
    font-size: 14px;
  }

  .subtitle {
    font-size: 18px;
    margin-bottom: 6px;
    color: #4a2603;
    font-weight: bold;
  }

  .info {
    background: rgba(255,255,255,0.7);
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid #d2b273;
    margin-bottom: 14px;
    font-size: 13px;
  }

  label {
    display: block;
    margin-top: 16px;
    font-weight: bold;
    color: #4a2603;
  }

  input, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border-radius: 4px;
    border: 1px solid #c19b63;
    background: #f8f0db;
    font-size: 13px;
  }

  textarea {
    resize: vertical;
    min-height: 80px;
  }

  .btn {
    display: inline-block;
    margin-top: 18px;
    padding: 9px 14px;
    background: linear-gradient(to bottom, #ffd56c, #b67b1a);
    border: 2px solid #f3dc8b;
    color: #251300;
    font-weight: bold;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    text-shadow: 1px 1px 0 #ffeeb0;
  }

  .btn:hover {
    filter: brightness(1.08);
  }

  #char-info {
    display: none;
    background: rgba(255,255,255,0.85);
    border: 1px solid #c19b63;
    padding: 10px;
    border-radius: 4px;
    margin-top: 10px;
    font-size: 13px;
  }

  #step2, #step3 {
    display: none;
  }

  #message {
    margin-top: 12px;
    font-weight: bold;
    text-align: center;
    color: #6e3a07;
  }

</style>
</head>
<body>

<div class="main-wrapper">

  <div class="header">Quest & Boss Access</div>

  <div class="content">

    <div class="subtitle">Organize seus acessos no estilo Tibia</div>

    <div class="info">
      1) Digite o nome do personagem Tibia.<br>
      2) Validamos level e vocação automaticamente.<br>
      3) Escolha o acesso desejado e envie.
    </div>

    <!-- STEP 1 -->
    <label>Nome do personagem *</label>
    <input id="charName" placeholder="Ex: Kevin Eger">

    <button class="btn" onclick="validateChar()">Validar personagem</button>

    <div id="char-info"></div>

    <!-- STEP 2 -->
    <div id="step2">
      <label>Quest / Boss *</label>
      <input id="requestedAccess" placeholder="Ex: Roshamuul, Falcon, Warzone...">
    </div>

    <!-- STEP 3 -->
    <div id="step3">
      <label>Notas (opcional)</label>
      <textarea id="notes" placeholder="Horários disponíveis, progressos, etc."></textarea>

      <button class="btn" onclick="submitForm()">Enviar</button>
      <div id="message"></div>
    </div>

  </div>
</div>

<script>

let charData = null;

async function validateChar() {
  const name = document.getElementById("charName").value.trim();
  const msg = document.getElementById("message");
  const info = document.getElementById("char-info");

  msg.innerHTML = "";
  info.style.display = "none";
  charData = null;

  document.getElementById("step2").style.display = "none";
  document.getElementById("step3").style.display = "none";

  if (!name) {
    msg.innerHTML = "Digite o nome do personagem.";
    return;
  }

  msg.innerHTML = "Validando personagem...";

  try {
    const data = await fetch(`https://api.tibiadata.com/v4/character/${encodeURIComponent(name)}`);
    const json = await data.json();

    if (!json.character || !json.character.character) {
      msg.innerHTML = "Personagem não encontrado.";
      return;
    }

    const c = json.character.character;
    charData = c;

    info.style.display = "block";
    info.innerHTML = `
      <b>Nome:</b> ${c.name}<br>
      <b>Level:</b> ${c.level}<br>
      <b>Vocação:</b> ${c.vocation}
    `;

    msg.innerHTML = "";
    document.getElementById("step2").style.display = "block";
    document.getElementById("step3").style.display = "block";

  } catch (e) {
    msg.innerHTML = "Erro ao validar. Tente novamente.";
  }
}

async function submitForm() {
  const msg = document.getElementById("message");

  if (!charData) {
    msg.innerHTML = "Valide o personagem primeiro.";
    return;
  }

  const requested = document.getElementById("requestedAccess").value.trim();
  const notes = document.getElementById("notes").value.trim();

  if (!requested) {
    msg.innerHTML = "Informe a quest/boss.";
    return;
  }

  msg.innerHTML = "Enviando...";

  const payload = {
    charName: charData.name,
    level: charData.level,
    vocation: charData.vocation,
    requestedAccess: requested,
    notes: notes
  };

  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbxXNT-qfqMwpDpI5YidY8ZS1_DFS3Ey2bP39qj4KM-DL2wljYaa6dptBrSs-D5dZhNk/exec", {
      method: "POST",
      body: JSON.stringify(payload)
    });

    const out = await res.json();

    if (out.success) {
      msg.innerHTML = "Registrado com sucesso!";
      document.getElementById("requestedAccess").value = "";
      document.getElementById("notes").value = "";
    } else {
      msg.innerHTML = "Erro ao salvar.";
    }

  } catch {
    msg.innerHTML = "Erro ao enviar.";
  }
}

</script>

</body>
</html>
