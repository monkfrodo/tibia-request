<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tibia Access Manager</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: url("https://www.tibiabr.com/wp-content/uploads/2020/01/paulo-silvente-roshamuul-ld-alternative.jpg")
            no-repeat center center fixed;
        background-size: cover;
        font-family: "Verdana", sans-serif;
        color: #fff;
    }

    /* overlay fixa */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(4px);
        z-index: 1;
    }

    /* Caixa CENTRALIZADA real */
    .card {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);

        background: rgba(0, 0, 0, 0.72);
        padding: 35px;
        border-radius: 12px;
        width: 100%;
        max-width: 480px;
        text-align: center;

        z-index: 2;
        border: 1px solid rgba(255, 215, 0, 0.25);
        box-shadow: 0 0 18px rgba(0,0,0,0.7);
    }

    .icon {
        width: 60px;
        height: 60px;
        image-rendering: pixelated;
        margin-bottom: 15px;
    }

    h1 {
        font-size: 26px;
        margin-bottom: 10px;
        color: #f5d98b;
        text-shadow: 1px 1px 2px #000;
    }

    .subtitle {
        font-size: 13px;
        margin-bottom: 25px;
        opacity: 0.9;
    }

    input {
        width: 100%;
        padding: 12px;
        margin-bottom: 16px;
        background: rgba(255,255,255,0.07);
        border: 1px solid rgba(255,255,255,0.25);
        border-radius: 6px;
        color: #fff;
        font-size: 15px;
    }

    button {
        width: 100%;
        padding: 14px;
        background: #d1ac4a;
        border: none;
        border-radius: 6px;
        color: #000;
        font-weight: bold;
        font-size: 15px;
        cursor: pointer;
        margin-bottom: 10px;
    }

    button:hover {
        background: #e6c86a;
    }

    .result-box {
        display: none;
        margin-top: 15px;
        padding: 12px;
        background: rgba(0, 0, 0, 0.60);
        border-radius: 6px;
        border: 1px solid rgba(255, 215, 0, 0.3);
        text-align: left;
        line-height: 1.5;
        font-size: 14px;
    }
</style>
</head>

<body>

<div class="overlay"></div>

<div class="card">

    <img src="https://www.tibiawiki.com.br/images/0/0f/Ferumbras.gif" class="icon" />

    <h1>Tibia Access Manager</h1>
    <div class="subtitle">Valide seu personagem e registre acessos de quests e bosses.</div>

    <input id="charName" placeholder="Digite o nome do seu personagem" />

    <button onclick="validateCharacter()">Validar Personagem</button>

    <div id="charResult" class="result-box"></div>

    <div id="questForm" style="display:none; margin-top:20px;">
        <input id="questName" list="questsList" placeholder="Digite a quest/boss (autocomplete)" />
        <datalist id="questsList"></datalist>

        <button onclick="sendRequest()">Enviar Pedido</button>
    </div>

</div>

<script>
/* === carrega JSON === */
fetch("quests.json")
    .then(r => r.json())
    .then(data => {
        const list = document.getElementById("questsList");
        data.sort().forEach(q => {
            const opt = document.createElement("option");
            opt.value = q;
            list.appendChild(opt);
        });
    });

/* === validacao CORRIGIDA === */
function validateCharacter() {
    const name = document.getElementById("charName").value.trim();
    if (!name) return alert("Digite o nome do personagem.");

    fetch(`https://api.tibiadata.com/v4/character/${name}`)
        .then(r => r.json())
        .then(d => {
            const box = document.getElementById("charResult");

            if (!d.character || d.character.error || !d.character.data) {
                box.style.display = "block";
                box.innerHTML = "❌ Personagem não encontrado.";
                return;
            }

            const c = d.character.data;

            box.style.display = "block";
            box.innerHTML = `
                <b>Nome:</b> ${c.name}<br>
                <b>Nível:</b> ${c.level}<br>
                <b>Vocação:</b> ${c.vocation}
            `;

            document.getElementById("questForm").style.display = "block";
        });
}

/* === envio === */
function sendRequest() {
    const name = document.getElementById("charName").value.trim();
    const quest = document.getElementById("questName").value.trim();

    if (!quest) return alert("Digite a quest/boss.");

    fetch("https://script.google.com/macros/s/AKfycbxXNT-qfqMwpDpI5YidY8ZS1_DFS3Ey2bP39qj4KM-DL2wljYaa6dptBrSs-D5dZhNk/exec", {
        method: "POST",
        body: JSON.stringify({ name, quest })
    });

    alert("Pedido enviado!");
}
</script>

</body>
</html>
